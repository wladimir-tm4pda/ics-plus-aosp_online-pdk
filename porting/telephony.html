<!DOCTYPE html>


































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico" />
<title>Radio Layer Interface | Android Open Source</title>
<link href="/assets/android-developer-docs-devguide.css" rel="stylesheet" type="text/css" />
<!-- <link href="/assets-pdk/pdk-local.css" rel="stylesheet" type="text/css" /> -->
<script src="/assets/search_autocomplete.js" type="text/javascript"></script>
<script src="/assets/jquery-resizable.min.js" type="text/javascript"></script>
<script src="/assets/android-developer-docs.js" type="text/javascript"></script>
<script type="text/javascript">
  setToRoot("/");
</script>
<script type="text/javascript">
  function resizeDoxFrameHeight() {
	if(document.getElementById && !(document.all)) {
		height= document.getElementById('doxygen').contentDocument.body.scrollHeight + 20;
		document.getElementById('doxygen').style.height = height+"pt";
	}
	else if(document.all) {
		height= document.frames('doxygen').document.body.scrollHeight + 20;
		document.all.doxygen.style.height = height;
	}
}
</script>
<script type="text/javascript">
  jQuery(document).ready(function() {
        jQuery("pre").addClass("prettyprint");
  });
</script>
<noscript>
  <style type="text/css">
    body{overflow:auto;}
    #body-content{position:relative; top:0;}
    #doc-content{overflow:visible;border-left:3px solid #666;}
    #side-nav{padding:0;}
    #side-nav .toggle-list ul {display:block;}
    #resize-packages-nav{border-bottom:3px solid #666;}
  </style>
</noscript>
</head>

<body class="gc-documentation" itemscope itemtype="http://schema.org/Article">

  <div id="header">
      <div id="headerLeft">
          <a href="/" tabindex="-1"><img
              src="/assets/images/open_source.png" alt="Android Open Source Project" /></a>
          <ul class="porting">
              <li id="home-link"><a href="/index.html"><span>Home</span></a></li>
              <li id="source-link"><a href="/source/index.html"
                                  onClick="return loadLast('source')"><span>Source</span></a></li>
              <li id="porting-link"><a href="/porting/index.html"
                                  onClick="return loadLast('porting')"><span>Porting</span></a></li>
              <li id="compatibility-link"><a href="/compatibility/index.html"
                                  onClick="return loadLast('compatibility')"><span>Compatibility</span></a></li>
              <li id="community-link"><a href="/community/index.html"
                                  onClick="return loadLast('community')"><span>Community</span></a></li>
              <li id="about-link"><a href="/about/index.html"
                                  onClick="return loadLast('about')"><span>About</span></a></li>
          </ul> 
      </div>
      <div id="headerRight">
          <div id="headerLinks">
            <!-- <img src="/assets/images/icon_world.jpg" alt="" /> -->
            <span class="text">
              <!-- &nbsp;<a href="#">English</a> | -->
              <a href="http://www.android.com">Android.com</a>
            </span>
          </div>
      </div><!-- headerRight -->
  </div><!-- header -->

  
    
      
  <div class="g-section g-tpl-240" id="body-content">
    <div class="g-unit g-first side-nav-resizable" id="side-nav">
      <div id="devdoc-nav"><script type="text/javascript" language="JavaScript">
<!--
function nothing() {}
-->
</script>

<ul>

<li> <h2>Setup and Building</h2>
  <ul>
     <li class="toggle-list">
     <div><a href="/porting/build_system.html">Build System</a></div>
     <ul>  
       <li><a href="/porting/build_new_device.html">Configuring a New Product</a></li>
       <li><a href="/porting/build_cookbook.html">Build Cookbook</a></li>
     </ul>
     </li>
     <li><a href="/porting/release_keys.html">Release Keys and Signing Builds</a></li> 
 </ul>
</li>

<li> <h2>Customization</h2>
  <ul>
    <li><a href="/porting/customization.html">Customization</a></li>
    <li><a href="/porting/usersguide.html">Android User's Guide</a></li>
  </ul>
</li>

<li> <h2>System</h2>

<ul>
  <li><a href="/porting/bring_up.html">Bring up</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Connectivity</a></div>
    <ul> 
      <li><a href="/porting/bluetooth.html">Bluetooth</a></li>
      <li><a href="/porting/gps.html">GPS</a></li>
      <li><a href="/porting/wifi.html">Wi-Fi</a></li>
    </ul>
  </li>

  <li><a href="/porting/display_drivers.html">Display Drivers</a></li>
  <li class="toggle-list"> 
    <div><a href="javascript:nothing()">Input Devices</a></div>
    <ul>
      <li><a href="/porting/keymaps_keyboard_input.html">Keymaps and Keyboard</a></li>
    </ul>
  </li>
  <li><a href="/porting/lights.html">Lights</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Multimedia</a></div>
    <ul>
      <li><a href="/porting/audio.html">Audio</a></li>
      <li><a href="/porting/camera.html">Camera/Video</a></li>
    </ul>
  </li>
  
  <li><a href="/porting/power_management.html">Power Management</a></li>
  <li><a href="/porting/sensors.html">Sensors</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Telephony</a></div>
    <ul>
      <li><a href="/porting/telephony.html">Radio Interface Layer</a></li>
      <li><a href="/porting/stk.html">SIM Toolkit Application (STK)</a></li>
    </ul>
  </li>

</ul>
</li>

<li> <h2>Dalvik Virtual Machine</h2>
  <ul>
    <li><a href="/porting/dalvik.html">Porting Dalvik</a></li>
  </ul>
</li>
<li> <h2>Testing and Debugging</h2>
  <ul>
    <li><a href="/porting/instrumentation_testing.html">Instrumentation Testing</a></li>
    <li><a href="/porting/debugging_gdb.html">Debugging with GDB</a></li>
    <li><a href="/porting/debugging_native.html">Debugging Native Code</a></li>
    <li><a href="/porting/tcpdump.html">Debugging with tcpdump</a></li>
  </ul>
</li>



</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
//-->
</script>

      </div>
    </div> <!-- end side-nav -->
    <script>
      addLoadEvent(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>
  </div>

    
  




<div class="g-unit" id="doc-content"><a name="top"></a>

<div id="jd-header" class="guide-header">
  <span class="crumb" itemprop="breadcrumb">
    &nbsp;
    
  </span>
<h1 itemprop="name">Radio Layer Interface</h1>
</div>

  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
<div id="qv">
<h2>In this document</h2>
<a name="toc"/>
<ul>
<li><a href="#androidTelephonyRILInitialization">RIL Initialization</a></li>
<li><a href="#androidTelephonyRILIntro">RIL Interaction</a></li>
<li><a href="#androidTelephonyRILImplementing">Implementing the RIL</a></li>
<li><a href="#androidTelephonyRILFunctions">RIL Functions</a></li>
</ul>
</div>
</div>

<p>Android's Radio Interface Layer (RIL) provides an abstraction layer between Android telephony services (<a href="http://code.google.com/android/reference/android/telephony/package-descr.html">android.telephony</a>) and radio hardware. The RIL is radio agnostic, and includes support for Global System for Mobile communication (GSM)-based radios.&nbsp;</P>


<p>The diagram below illustrates the RIL in the context of Android's Telephony system architecture.</p>
<p><img src="images/telephony.gif"></p>

Solid elements represent Android blocks and dashed elements represent partner-specific blocks.

<p>The RIL consists of two primary components:</p>
<p><ul>
<li><b>RIL Daemon</b>: The RIL daemon initializes the Vendor RIL, processes all communication from Android telephony services, and dispatches calls to the Vendor RIL as solicited commands.</li>
<li><b>Vendor RIL</b>: The radio-specific Vendor RIL of <code>ril.h</code> that processes all communication with radio hardware and dispatches calls to the RIL Daemon (<code>rild</code>) through unsolicited commands.</li>
</ul>
</p>


<a name="androidTelephonyRILInitialization"></a><h3>RIL Initialization</h3>

<p>Android initializes the telephony stack and the Vendor RIL at startup as described in the sequence below:</p>
<p><ol>
<li>RIL daemon reads <code>rild.lib</code> path and <code>rild.libargs</code> system properties to determine the Vendor RIL library to use and any initialization arguments to provide to the Vendor RIL</li>
<li>RIL daemon loads the Vendor RIL library and calls <code>RIL_Init</code> to initialize the RIL and obtain a reference to RIL functions</li>
<li>RIL daemon calls <code>RIL_register</code> on the Android telephony stack, providing a reference to the Vendor RIL functions</li></ol>
</p>
<p>See the RIL Daemon source code at <code>//device/commands/rild/rild.c</code> for details.</p>
<p><b>System Properties</b></p>
<p>The following RIL-related system properties are set by the RIL library:</p>
<p><ul>
<li><code>ro.ril.ecclist</code>: list of valid Emergency Call Codes, for example, 911. Values are read from <code>EF_ECC</code> on the SIM and possibly supplmented by tables based on operator, network, or manufacturing code.</li></ul></p>

<p>The following RIL_related system properties are available to the RIL library:</p>
<p><ul>
<li><code>ro.ril.hsxpa</code>: inidcates <code>hsxpa</code> support of target network.</li>
<li><code>ro.ril.gprsclass</code>: inidcates GPRS class of target network.</li>
<li><code>ro.ril.enable.3g.prefix=1</code>: adds the 3G prefix to the operator name.</li>
</ul></p>

<a name="androidTelephonyRILIntro"></a><h3>RIL Interaction</h3>

<p>There are two forms of communication that the RIL handles:</p>
<ul>
  <li>Solicited commands: Solicited commands originated by RIL lib, such as <code>DIAL</code> and <code>HANGUP</code>.</li>
  <li>Unsolicited responses: Unsolicited responses that originate from the baseband, such as <code>CALL_STATE_CHANGED</code> and <code>NEW_SMS</code>.</li>
</ul>


<a name="androidTelephonyRILSolicited"></a><h4>Solicited</h4>

<p>The following snippet illustrates the interface for solicited commands:</p>
<pre class="prettify">
void OnRequest (int request_id, void *data, size_t datalen, RIL_Token t);&#13;
void OnRequestComplete (RIL_Token t, RIL_Error e, void *response, size_t responselen);&#13;
</pre>
<p>There are over sixty solicited commands grouped by the following families:</p>
<p>
<ul>
  <li>SIM PIN, IO, and IMSI/IMEI (11)</li>
  <li>Call status and handling (dial, answer, mute&hellip;) (16)</li>
  <li>Network status query (4)</li>
  <li>Network setting (barring, forwarding, selection&hellip;) (12)</li>
  <li>SMS (3)</li>
  <li>PDP connection (4)</li>
  <li>Power and reset (2)</li>
  <li>Supplementary Services (5)</li>
  <li>Vendor defined and support (4)<br/>
                    </li>
</ul>
</p>
<p>The following diagram illustrates a solicited call in Android.</p>
<p><img src="images/telephony_solicted_example.gif"></p>


<a name="androidTelephonyRILUnsolicited"></a><h4>Unsolicited</h4>

<p>The following snippet illustrates the interface for unsolicited commands:</p>
<pre class="prettify">
void OnUnsolicitedResponse (int unsolResponse, void *data, size_t datalen);
</pre>
<p>There are over ten unsolicited commands grouped by the following families:</p>
<p>
<ul>
<li>Network status changed (4)</li>
<li>New SMS notify (3)</li>
<li>New USSD notify (2)</li>
<li>Signal strength or time changed (2)</li>
</ul>
</p>
<p>The following diagram illustrates an unsolicited call in Android.</p>
<p><img src="images/telephony_unsolicted_example.gif"></p>


<a name="androidTelephonyRILImplementing"></a><h3>Implementing the RIL</h3>

<p>To implement a radio-specific RIL, create a shared library that implements a set of functions required by Android to process radio requests. The required functions are defined in the RIL header (<code>/include/telephony/ril.h</code>).</p>
<p>The Android radio interface is radio-agnostic and the Vendor RIL can use any protocol to communicate with the radio.&nbsp;Android provides a reference Vendor RIL, using the Hayes AT command set, that you can use as a quick start for telephony testing and a guide for commercial vendor RILs. The source code for the reference RIL is found at <code>/commands/reference-ril/</code>.</p>
<p>Compile your Vendor RIL as a shared library using the convention <code>libril-&lt;companyname&gt;-&lt;RIL version&gt;.so</code>, for example, libril-acme-124.so, where:</p>
<p><ul>
<li><b>libril</b>: all vendor RIL implementations start with 'libril'</li>
<li><b>&lt;companyname&gt;</b>: a company-specific abbreviation</li>
<li><b>&lt;RIL version&gt;</b>: RIL version number</li>
<li><b>so</b>: file extension</li>
</ul>
</p>


<a name="androidTelephonyRILInit"></a><h4>RIL_Init</h4>

<p>Your Vendor RIL must define a RIL_Init function that provides a handle to the functions which will process all radio requests.  RIL_Init will be called by the Android RIL Daemon at boot time to initialize the RIL.</p>

<pre class="prettify">
RIL_RadioFunctions *RIL_Init (RIL_Env* env, int argc, char **argv);
</pre>

<p>RIL_Init should return a RIL_RadioFunctions structure containing the handles to the radio functions:</p>
<pre class="prettify">
type structure {
	int RIL_version;
	RIL_RequestFunc onRequest;
	RIL_RadioStateRequest onStateRequest;      
	RIL_Supports supports;
	RIL_Cancel onCancel;
	RIL_GetVersion getVersion;
} 
RIL_RadioFunctions;
</pre>


<a name="androidTelephonyRILFunctions"></a><h3>RIL Functions</h3>

<p><code>ril.h</code> defines RIL states and variables, such as <code>RIL_UNSOL_STK_CALL_SETUP</code>, <code>RIL_SIM_READY</code>, <code>RIL_SIM_NOT_READY</code>, as well as the functions described in the tables below. Skim the header file (<code>/device/include/telephony/ril.h</code>) for details.</p>


<a name="androidRilFunctionsSolicited"></a><h4>RIL Solicited Command Requests</h4>

<p>The vendor RIL must provide the functions described in the table below to handle solicited commands. The RIL solicited command request types are defined in <code>ril.h</code> with the <code>RIL_REQUEST_</code> prefix. Check the header file for details.</p>
<p><table>
  <tr><th scope="col">Name</th><th scope="col">Description</th></tr>
  <tr>
    <td valign="top"><code> void (*RIL_RequestFunc) (int request, void *data, size_t datalen, RIL_Token t);</code></td>
    <td valign="top">
	<p>This is the RIL entry point for solicited commands and must be able to handle the various RIL solicited request types defined in <code>ril.h</code> with the <code>RIL_REQUEST_</code> prefix.</p>
	<ul>
        <li><code>request</code> is one of <code>RIL_REQUEST_*</code></li>
        <li><code>data</code> is pointer to data defined for that <code>RIL_REQUEST_*</code></l>
        <li><code>t</code> should be used in subsequent call to <code>RIL_onResponse</code></li>
        <li><code>datalen</code> is owned by caller, and should not be modified or freed by callee</li>
      </ul>
	<p>Must be completed with a call to <code>RIL_onRequestComplete()</code>. &nbsp;<code>RIL_onRequestComplete()</code> may be called from any thread before or after this function returns. This will &nbsp;always be called from the same thread, so returning here implies that the radio is ready to process another command (whether or not the previous command has completed).</p></td>
  </tr>
  <tr>
    <td valign="top"><code> RIL_RadioState (*RIL_RadioStateRequest)();</code></td>
    <td valign="top">This function should return the current radio state synchronously.</td>
  </tr>
  <tr>
    <td valign="top"><code> int (*RIL_Supports)(int requestCode);</code></td>
    <td valign="top">This function returns "1" if the specified <code>RIL_REQUEST</code> code is supported and 0 if it is not.</td>
  </tr>
  <tr>
    <td valign="top"><code> void (*RIL_Cancel)(RIL_Token t);</code></td>
    <td valign="top"><p>This function is used to indicate that a pending request should be canceled. This function is called from a separate thread--not the thread that calls <code>RIL_RequestFunc</code>.</p>
      <p>On cancel, the callee should do its best to abandon the request and call <code>RIL_onRequestComplete</code> with <code>RIL_Errno CANCELLED</code> at some later point.</p>
      <p>Subsequent calls to <code>RIL_onRequestComplete</code> for this request with other results will be tolerated but ignored (that is, it is valid to ignore the cancellation request).</p>
    <p><code>RIL_Cancel</code> calls should return immediately and not wait for cancellation.</p></td>
  </tr>
  <tr>
    <td valign="top"><code> const char * (*RIL_GetVersion) (void);</code></td>
    <td valign="top">Return a version string for your Vendor RIL</td>
  </tr>
</table>


<p>The vendor RIL uses the following callback methods to communicate back to the Android RIL daemon.</p>
<p>
<table>
  <tr>
    <th scope="col">Name</th>
    <th scope="col">Description</th>
  </tr>
  <tr>
    <td><code>void RIL_onRequestComplete(RIL_Token t, RIL_Errno e, void *response, size_t responselen);</code></td>
    <td><ul>
      <li><code>t</code> is parameter passed in on previous call to <code>RIL_Notification</code> routine.</li>
      <li>If <code>e</code> != SUCCESS, then response can be null and is ignored</li>
      <li><code>response</code> is owned by caller, and should not be modified or freed by callee</li>
      <li><code>RIL_onRequestComplete</code> will return as soon as possible</li>
    </ul></td>
  </tr>
  <tr>
    <td><code>void RIL_requestTimedCallback (RIL_TimedCallback callback, void *param, const struct timeval *relativeTime);</code></td>
    <td>Call user-specified callback function on the same thread that <code>RIL_RequestFunc</code> is called. If <code>relativeTime</code> is specified, then it specifies a relative time value at which the callback is invoked. If <code>relativeTime</code> is NULL or points to a 0-filled structure, the callback will be invoked as soon as possible.</td>
  </tr>
</table></p>


<a name="androidRilFunctionsUnsolicited"></a><h4>RIL Unsolicited Commands</h4>

<p>The functions listed in the table below are call-back functions used by the Vendor RIL to invoke unsolicited commands on the Android platform. See <code>ril.h</code> for details. </p>
<p>
<table>
  <tr>
    <th scope="col">Name</th>
    <th scope="col">Description</th>
  </tr>
  <tr>
    <td><code>void RIL_onUnsolicitedResponse(int unsolResponse, const void *data, size_t datalen);</code></td>
    <td><ul>
      <li><code>unsolResponse</code> is one of <code>RIL_UNSOL_RESPONSE_*</code></li>
      <li><code>data</code> is pointer to data defined for that <code>RIL_UNSOL_RESPONSE_*</code></li>
      <li><code>data</code> is owned by caller, and should not be modified or freed by callee</li>
    </ul></td>
  </tr>
</table></p>

    </div>

  <a href="#top" style="float:right">&uarr; Go to top</a>
  
  </div>

<div id="footer">


  <div id="copyright">
    

  </div>

  <div id="footerlinks">
    
  <p>
    <a href="http://www.android.com/terms.html">Site Terms of Service</a> -
    <a href="http://www.android.com/privacy.html">Privacy Policy</a>
  </p>
  </div>

</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end body-content --> 

<script type="text/javascript">
init(); /* initialize android-developer-docs.js */
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5831155-1");
pageTracker._trackPageview();
</script>

</body>
</html>



