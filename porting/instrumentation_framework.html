<!DOCTYPE html>


































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico" />
<title>Instrumentation Framework | Android Open Source</title>
<link href="/assets/android-developer-docs-devguide.css" rel="stylesheet" type="text/css" />
<!-- <link href="/assets-pdk/pdk-local.css" rel="stylesheet" type="text/css" /> -->
<script src="/assets/search_autocomplete.js" type="text/javascript"></script>
<script src="/assets/jquery-resizable.min.js" type="text/javascript"></script>
<script src="/assets/android-developer-docs.js" type="text/javascript"></script>
<script type="text/javascript">
  setToRoot("/");
</script>
<script type="text/javascript">
  function resizeDoxFrameHeight() {
	if(document.getElementById && !(document.all)) {
		height= document.getElementById('doxygen').contentDocument.body.scrollHeight + 20;
		document.getElementById('doxygen').style.height = height+"pt";
	}
	else if(document.all) {
		height= document.frames('doxygen').document.body.scrollHeight + 20;
		document.all.doxygen.style.height = height;
	}
}
</script>
<script type="text/javascript">
  jQuery(document).ready(function() {
        jQuery("pre").addClass("prettyprint");
  });
</script>
<noscript>
  <style type="text/css">
    body{overflow:auto;}
    #body-content{position:relative; top:0;}
    #doc-content{overflow:visible;border-left:3px solid #666;}
    #side-nav{padding:0;}
    #side-nav .toggle-list ul {display:block;}
    #resize-packages-nav{border-bottom:3px solid #666;}
  </style>
</noscript>
</head>

<body class="gc-documentation" itemscope itemtype="http://schema.org/Article">

  <div id="header">
      <div id="headerLeft">
          <a href="/" tabindex="-1"><img
              src="/assets/images/open_source.png" alt="Android Open Source Project" /></a>
          <ul class="porting">
              <li id="home-link"><a href="/index.html"><span>Home</span></a></li>
              <li id="source-link"><a href="/source/index.html"
                                  onClick="return loadLast('source')"><span>Source</span></a></li>
              <li id="porting-link"><a href="/porting/index.html"
                                  onClick="return loadLast('porting')"><span>Porting</span></a></li>
              <li id="compatibility-link"><a href="/compatibility/index.html"
                                  onClick="return loadLast('compatibility')"><span>Compatibility</span></a></li>
              <li id="community-link"><a href="/community/index.html"
                                  onClick="return loadLast('community')"><span>Community</span></a></li>
              <li id="about-link"><a href="/about/index.html"
                                  onClick="return loadLast('about')"><span>About</span></a></li>
          </ul> 
      </div>
      <div id="headerRight">
          <div id="headerLinks">
            <!-- <img src="/assets/images/icon_world.jpg" alt="" /> -->
            <span class="text">
              <!-- &nbsp;<a href="#">English</a> | -->
              <a href="http://www.android.com">Android.com</a>
            </span>
          </div>
      </div><!-- headerRight -->
  </div><!-- header -->

  
    
      
  <div class="g-section g-tpl-240" id="body-content">
    <div class="g-unit g-first side-nav-resizable" id="side-nav">
      <div id="devdoc-nav"><script type="text/javascript" language="JavaScript">
<!--
function nothing() {}
-->
</script>

<ul>

<li> <h2>Setup and Building</h2>
  <ul>
     <li class="toggle-list">
     <div><a href="/porting/build_system.html">Build System</a></div>
     <ul>  
       <li><a href="/porting/build_new_device.html">Configuring a New Product</a></li>
       <li><a href="/porting/build_cookbook.html">Build Cookbook</a></li>
     </ul>
     </li>
     <li><a href="/porting/release_keys.html">Release Keys and Signing Builds</a></li> 
 </ul>
</li>

<li> <h2>Customization</h2>
  <ul>
    <li><a href="/porting/customization.html">Customization</a></li>
    <li><a href="/porting/usersguide.html">Android User's Guide</a></li>
  </ul>
</li>

<li> <h2>System</h2>

<ul>
  <li><a href="/porting/bring_up.html">Bring up</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Connectivity</a></div>
    <ul> 
      <li><a href="/porting/bluetooth.html">Bluetooth</a></li>
      <li><a href="/porting/gps.html">GPS</a></li>
      <li><a href="/porting/wifi.html">Wi-Fi</a></li>
    </ul>
  </li>

  <li><a href="/porting/display_drivers.html">Display Drivers</a></li>
  <li class="toggle-list"> 
    <div><a href="javascript:nothing()">Input Devices</a></div>
    <ul>
      <li><a href="/porting/keymaps_keyboard_input.html">Keymaps and Keyboard</a></li>
    </ul>
  </li>
  <li><a href="/porting/lights.html">Lights</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Multimedia</a></div>
    <ul>
      <li><a href="/porting/audio.html">Audio</a></li>
      <li><a href="/porting/camera.html">Camera/Video</a></li>
    </ul>
  </li>
  
  <li><a href="/porting/power_management.html">Power Management</a></li>
  <li><a href="/porting/sensors.html">Sensors</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Telephony</a></div>
    <ul>
      <li><a href="/porting/telephony.html">Radio Interface Layer</a></li>
      <li><a href="/porting/stk.html">SIM Toolkit Application (STK)</a></li>
    </ul>
  </li>

</ul>
</li>

<li> <h2>Dalvik Virtual Machine</h2>
  <ul>
    <li><a href="/porting/dalvik.html">Porting Dalvik</a></li>
  </ul>
</li>
<li> <h2>Testing and Debugging</h2>
  <ul>
    <li><a href="/porting/instrumentation_testing.html">Instrumentation Testing</a></li>
    <li><a href="/porting/debugging_gdb.html">Debugging with GDB</a></li>
    <li><a href="/porting/debugging_native.html">Debugging Native Code</a></li>
    <li><a href="/porting/tcpdump.html">Debugging with tcpdump</a></li>
  </ul>
</li>



</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
//-->
</script>

      </div>
    </div> <!-- end side-nav -->
    <script>
      addLoadEvent(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>
  </div>

    
  




<div class="g-unit" id="doc-content"><a name="top"></a>

<div id="jd-header" class="guide-header">
  <span class="crumb" itemprop="breadcrumb">
    &nbsp;
    
  </span>
<h1 itemprop="name">Instrumentation Framework</h1>
</div>

  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <a name="toc"/>
<div style="padding:10px">
<a href="#androidInstrumentationFrameworkIntro">Introduction</a><br/>
<a href="#androidInstrumentationFrameworkamCommand">Understanding the am Command</a><br/>
<a href="#androidInstrumentationFrameworkWritingRunning">Writing and Running Test Cases</a><br/>
<a href="#androidInstrumentationFrameworkTestCase">Exploring a Test Case</a><br/>
<a href="#androidInstrumentationFrameworkTroubleshooting">Troubleshooting</a><br/></div>

<a name="androidInstrumentationFrameworkIntro"></a><h2>Introduction</h2>

<p>This document describes how to use the Instrumentation Framework to write test cases. You should have a working knowledge of the following:</p>
<ul>
  <li> Android Application Framework </li>
  <li> Using <code>adb</code>, <code>am</code> and various logging functionality </li>
  <li> A brief understanding of the application of interest, that is, he names of the classes which handle the intents etc. </li>
  <li> Junit testing. </li>
</ul>
<p> Each Android application runs in its own process. Instrumentation kills the application process and  restarts the process with Instrumentation. Instrumentation gives a handle to the application context used to poke around the application to validate test assertions, allowing you to write test cases to test applications at a much lower level than UI screen shot tests. Note that Instrumentation cannot catch UI bugs. </p>


<a name="androidInstrumentationFrameworkamCommand"></a><h2>Understanding the am Command</h2>

<p><code>am</code> is used to start and instrument activities using the adb shell command, as shown in the snippet below:</p>
<pre class="prettify">
&gt; adb shell am
usage: am [start|instrument]
       am start [-a &lt;ACTION&gt;] [-d &lt;DATA_URI&gt;] [-t &lt;MIME_TYPE&gt;]
                [-c &lt;CATEGORY&gt; [-c &lt;CATEGORY&gt;] ...]
                [-e &lt;EXTRA_KEY&gt; &lt;EXTRA_VALUE&gt; [-e &lt;EXTRA_KEY&gt; &lt;EXTRA_VALUE&gt; ...]
                [-n &lt;COMPONENT&gt;] [-D] [&lt;URI&gt;]
       am instrument [-e &lt;ARG_NAME&gt; &lt;ARG_VALUE&gt;] [-p &lt;PROF_FILE&gt;]
                [-w] &lt;COMPONENT&gt;
For example, to start the Contacts application you can use
&gt; adb shell am start -n com.google.android.contacts/.ContactsActivity
</pre>


<a name="androidInstrumentationFrameworkWritingRunning"></a><h2>Writing and Running Test Cases</h2>

<p>Each instrumentation test case is similar to an Android application with the distinction that it starts another application. For example, have a look in the <code>tests/Contacts</code> directory. </p>
<ul>
  <li> There should be a Makefile and an Android Manifest file. </li>
  <li> Tests are located in <code>tests/Contacts/src/com/google/android/contactstests</code>. </li>
  <li> The Instrumentation Test Runner is located at <code>tests/Contacts/src/com/google/android/contactstests/functional/ContactsInstrumentationTestRunner.java</code>.</li>
</ul>
<p>Suppose you have a makefile with <code>Contactstests</code> as the target. </p>
<ul>
  <li> <code>make Contactstests</code>: Compiles the test cases. </li>
  <li> <code>adb install Contactstests.apk</code>: Installs the apk on the device. </li>
  <li> Use the adb shell <code>am</code> command to run them. </li>
</ul>
<p> For options and other details, please see <a href="instrumentation_testing.html" target="_top">Instrumentation Testing</a>.</p>


<a name="androidInstrumentationFrameworkTestCase"></a><h2>Exploring a Test Case</h2>

<p> The test case described in this section adds and tests a new Contact. Note that you can send intents, register intent receivers, etc. </p>
<p><code>Instrumentation.java</code> has helper functions that send key events and string, for example: </p>
<ul>
  <li><code>getInstrumentation()</code>: Returns the handle to the instrumentation </li>
  <li><code>sendCharacterSync</code>: Sends a character. </li>
  <li><code>sendStringSync</code>: Sends a string to an input box. </li>
  <li><code>sendKeyDownUpSync</code>: Sends a specific keyevent. </li>
  <li><code>sendTrackballEventSync</code>: Send a trackball event.</li>
</ul>
<p> You can find the test case below at <code>device/tests/Contacts.</code></p>
<pre class="prettify">
private void addNewContact(String name, int star, int phoneType, String number, String label,
		String email, int emailType){
	ContentValues values = new ContentValues();
	Uri phoneUri = null;
	Uri emailUri = null;

	values.put(Contacts.People.NAME, name);
	values.put(Contacts.People.STARRED, star);

	//Add Phone Numbers
	Uri uri = mActivity.getContentResolver().insert(Contacts.People.CONTENT_URI, values);
	phoneUri = Uri.withAppendedPath(uri, Contacts.People.Phones.CONTENT_DIRECTORY);

	values.clear();
	values.put(Contacts.Phones.TYPE, phoneType);
	values.put(Contacts.Phones.NUMBER, number);
	values.put(Contacts.Phones.LABEL, label);
	mActivity.getContentResolver().insert(phoneUri, values);

	//Add Email
	emailUri = Uri.withAppendedPath(uri, ContactMethods.CONTENT_DIRECTORY);

	values.clear();
	values.put(ContactMethods.KIND, Contacts.KIND_EMAIL);
	values.put(ContactMethods.DATA, email);
	values.put(ContactMethods.LABEL, "");
	values.put(ContactMethods.TYPE, emailType);
	mActivity.getContentResolver().insert(emailUri, values);
}


 public void testAddSaveSingleContact(){
	int previousCount = mActivity.getListView().getCount();
	String message;

	addNewContact(INPUT_NAME_1 + "1", "5435754532", "1" + INPUT_EMAIL_1, CONFIRM_OPTION);

	message = "Added 1 to initial length=" + previousCount + ", but resulted with a count=" +
		mActivity.getListView().getCount();
	assertEquals(message, ++previousCount, mActivity.getListView().getCount());

	// Check Content; Name; Num; Starred
	assertEquals(INPUT_NAME_1 + "1", getTextFromView(0, android.R.id.text1));
	assertEquals("5435754532", getTextFromView(0, android.R.id.text2));

	//Check email is saved
	//cursor = returnEmailCursorAtId("1");
	Uri uri = Uri.parse("content://contacts/people/1");
	uri = Uri.withAppendedPath(uri, ContactMethods.CONTENT_DIRECTORY);
	Cursor cursor = mActivity.getContentResolver().query(uri, CONTACTS_COLUMNS, null, null, null);
	assertTrue("returnEmailCursorAtId: Moving cursor to first row has failed", cursor.first());

	int dataIndex = cursor.getColumnIndexOrThrow("data");
	assertEquals("1" + INPUT_EMAIL_1, cursor.getString(dataIndex));
	cursor.deactivate();
}
	</pre>


<a name="androidInstrumentationFrameworkTroubleshooting"></a><h2>Troubleshooting</h2>

<p>If you run your test cases and nothing appears to happen, have a look at <code>adb logcat</code>. The following is a common problem:</p>
<pre class="prettify">
I/dalvikvm(  688): threadid=11: attached from native, name=Binder Thread #1
I/dalvikvm(  688): threadid=13: attached from native, name=Binder Thread #2
W/ActivityManager(  469): Unable to find instrumentation info for: ComponentInfo{com.google.android.browser_instrumentation/com.google.android.browser_instrumentation.BrowserWebkitLayoutInstrumentation}
D/AndroidRuntime(  688): Shutting down VM
E/AndroidRuntime(  688): ERROR: thread attach failed
</pre>		
<p>It's possible that the instrumentation apk isn't installed on your device or that the package name is incorrect in the Manifest file. </p>


    </div>

  <a href="#top" style="float:right">&uarr; Go to top</a>
  
  </div>

<div id="footer">


  <div id="copyright">
    

  </div>

  <div id="footerlinks">
    
  <p>
    <a href="http://www.android.com/terms.html">Site Terms of Service</a> -
    <a href="http://www.android.com/privacy.html">Privacy Policy</a>
  </p>
  </div>

</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end body-content --> 

<script type="text/javascript">
init(); /* initialize android-developer-docs.js */
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5831155-1");
pageTracker._trackPageview();
</script>

</body>
</html>



