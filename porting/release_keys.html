<!DOCTYPE html>


































































<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<link rel="shortcut icon" type="image/x-icon" href="/assets/favicon.ico" />
<title>Creating Release Keys and Signing Builds | Android Open Source</title>
<link href="/assets/android-developer-docs-devguide.css" rel="stylesheet" type="text/css" />
<!-- <link href="/assets-pdk/pdk-local.css" rel="stylesheet" type="text/css" /> -->
<script src="/assets/search_autocomplete.js" type="text/javascript"></script>
<script src="/assets/jquery-resizable.min.js" type="text/javascript"></script>
<script src="/assets/android-developer-docs.js" type="text/javascript"></script>
<script type="text/javascript">
  setToRoot("/");
</script>
<script type="text/javascript">
  function resizeDoxFrameHeight() {
	if(document.getElementById && !(document.all)) {
		height= document.getElementById('doxygen').contentDocument.body.scrollHeight + 20;
		document.getElementById('doxygen').style.height = height+"pt";
	}
	else if(document.all) {
		height= document.frames('doxygen').document.body.scrollHeight + 20;
		document.all.doxygen.style.height = height;
	}
}
</script>
<script type="text/javascript">
  jQuery(document).ready(function() {
        jQuery("pre").addClass("prettyprint");
  });
</script>
<noscript>
  <style type="text/css">
    body{overflow:auto;}
    #body-content{position:relative; top:0;}
    #doc-content{overflow:visible;border-left:3px solid #666;}
    #side-nav{padding:0;}
    #side-nav .toggle-list ul {display:block;}
    #resize-packages-nav{border-bottom:3px solid #666;}
  </style>
</noscript>
</head>

<body class="gc-documentation" itemscope itemtype="http://schema.org/Article">

  <div id="header">
      <div id="headerLeft">
          <a href="/" tabindex="-1"><img
              src="/assets/images/open_source.png" alt="Android Open Source Project" /></a>
          <ul class="porting">
              <li id="home-link"><a href="/index.html"><span>Home</span></a></li>
              <li id="source-link"><a href="/source/index.html"
                                  onClick="return loadLast('source')"><span>Source</span></a></li>
              <li id="porting-link"><a href="/porting/index.html"
                                  onClick="return loadLast('porting')"><span>Porting</span></a></li>
              <li id="compatibility-link"><a href="/compatibility/index.html"
                                  onClick="return loadLast('compatibility')"><span>Compatibility</span></a></li>
              <li id="community-link"><a href="/community/index.html"
                                  onClick="return loadLast('community')"><span>Community</span></a></li>
              <li id="about-link"><a href="/about/index.html"
                                  onClick="return loadLast('about')"><span>About</span></a></li>
          </ul> 
      </div>
      <div id="headerRight">
          <div id="headerLinks">
            <!-- <img src="/assets/images/icon_world.jpg" alt="" /> -->
            <span class="text">
              <!-- &nbsp;<a href="#">English</a> | -->
              <a href="http://www.android.com">Android.com</a>
            </span>
          </div>
      </div><!-- headerRight -->
  </div><!-- header -->

  
    
      
  <div class="g-section g-tpl-240" id="body-content">
    <div class="g-unit g-first side-nav-resizable" id="side-nav">
      <div id="devdoc-nav"><script type="text/javascript" language="JavaScript">
<!--
function nothing() {}
-->
</script>

<ul>

<li> <h2>Setup and Building</h2>
  <ul>
     <li class="toggle-list">
     <div><a href="/porting/build_system.html">Build System</a></div>
     <ul>  
       <li><a href="/porting/build_new_device.html">Configuring a New Product</a></li>
       <li><a href="/porting/build_cookbook.html">Build Cookbook</a></li>
     </ul>
     </li>
     <li><a href="/porting/release_keys.html">Release Keys and Signing Builds</a></li> 
 </ul>
</li>

<li> <h2>Customization</h2>
  <ul>
    <li><a href="/porting/customization.html">Customization</a></li>
    <li><a href="/porting/usersguide.html">Android User's Guide</a></li>
  </ul>
</li>

<li> <h2>System</h2>

<ul>
  <li><a href="/porting/bring_up.html">Bring up</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Connectivity</a></div>
    <ul> 
      <li><a href="/porting/bluetooth.html">Bluetooth</a></li>
      <li><a href="/porting/gps.html">GPS</a></li>
      <li><a href="/porting/wifi.html">Wi-Fi</a></li>
    </ul>
  </li>

  <li><a href="/porting/display_drivers.html">Display Drivers</a></li>
  <li class="toggle-list"> 
    <div><a href="javascript:nothing()">Input Devices</a></div>
    <ul>
      <li><a href="/porting/keymaps_keyboard_input.html">Keymaps and Keyboard</a></li>
    </ul>
  </li>
  <li><a href="/porting/lights.html">Lights</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Multimedia</a></div>
    <ul>
      <li><a href="/porting/audio.html">Audio</a></li>
      <li><a href="/porting/camera.html">Camera/Video</a></li>
    </ul>
  </li>
  
  <li><a href="/porting/power_management.html">Power Management</a></li>
  <li><a href="/porting/sensors.html">Sensors</a></li>
  <li class="toggle-list">
    <div><a href="javascript:nothing()">Telephony</a></div>
    <ul>
      <li><a href="/porting/telephony.html">Radio Interface Layer</a></li>
      <li><a href="/porting/stk.html">SIM Toolkit Application (STK)</a></li>
    </ul>
  </li>

</ul>
</li>

<li> <h2>Dalvik Virtual Machine</h2>
  <ul>
    <li><a href="/porting/dalvik.html">Porting Dalvik</a></li>
  </ul>
</li>
<li> <h2>Testing and Debugging</h2>
  <ul>
    <li><a href="/porting/instrumentation_testing.html">Instrumentation Testing</a></li>
    <li><a href="/porting/debugging_gdb.html">Debugging with GDB</a></li>
    <li><a href="/porting/debugging_native.html">Debugging Native Code</a></li>
    <li><a href="/porting/tcpdump.html">Debugging with tcpdump</a></li>
  </ul>
</li>



</ul>

<script type="text/javascript">
<!--
    buildToggleLists();
//-->
</script>

      </div>
    </div> <!-- end side-nav -->
    <script>
      addLoadEvent(function() {
        scrollIntoView("devdoc-nav");
        });
    </script>
  </div>

    
  




<div class="g-unit" id="doc-content"><a name="top"></a>

<div id="jd-header" class="guide-header">
  <span class="crumb" itemprop="breadcrumb">
    &nbsp;
    
  </span>
<h1 itemprop="name">Creating Release Keys and Signing Builds</h1>
</div>

  <div id="jd-content">

    <div class="jd-descr" itemprop="articleBody">
    <div id="qv-wrapper">
  <div id ="qv"> 
<h2>In this document</h2>
<a name="toc"/>
    <ul>
      <li><a href="#intro">Introduction</a></li>
      <li><a href="#generatingKeys">Generating keys</a></li>
      <li><a href="#signing">Signing a build for release</a></li>
    </ul>
  </div>
</div>
<a name="intro"></a>
<h3>Introduction</h3>
<p>Android requires that each application be signed with the developer's digital keys to enforce signature permissions and application request to use shared user ID or target process.  For more information on the general Android security principles and signing requirements, see the Android Security and Permissions section in the Android Developer Guide).  The core Android platform uses four keys to maintain security of core platform components:</p>
<ul>
  <li><strong>platform</strong>: a key for packages that are part of the core platform.</li>
  <li><strong>shared</strong>: a key for things that are shared in the <code>home/contacts</code> process.</li>
  <li><strong>media</strong>: a key for packages that are part of the <code>media/download</code> system.</li>
  <li><strong>releasekey</strong>: the default key to sign with if not otherwise specified</li>
</ul>
<p>These keys are used to sign applications separately for release images and are not used by the Android build system.  The build system signs packages with the testkeys provided in <code>build/target/product/security/</code>.  Because the testkeys are part of the standard Android open source distribution, they should never be used for production devices.  Instead, device manufacturers should generate their own private keys for shipping release builds.</p>
<a name="generatingKeys"></a>
<h3>Generating keys</h3>
<p>A device manufacturer's keys for each product should be stored under  <code>vendor/&lt;vendor_name&gt;/security/&lt;product_name&gt;</code>, where <code>&lt;vendor_name&gt;</code> and <code>&lt;product_name&gt;</code> represent the manufacturer and product names.  To simplify key creation, copy the script below to this directory in a file called <code>mkkey.sh</code>.  To customize your keys, change the line that starts with AUTH to reflect the correct information for your company:</p>
<pre>
#!/bin/sh
AUTH='/C=US/ST=California/L=Mountain View/O=Android/OU=Android/CN=Android/emailAddress=android@android.com'
if [ "$1" == "" ]; then
        echo "Create a test certificate key."
        echo "Usage: $0 NAME"
        echo "Will generate NAME.pk8 and NAME.x509.pem"
        echo "  $AUTH"
        exit
fi

openssl genrsa -3 -out $1.pem 2048

openssl req -new -x509 -key $1.pem -out $1.x509.pem -days 10000 \
    -subj "$AUTH"

echo "Please enter the password for this key:"
openssl pkcs8 -in $1.pem -topk8 -outform DER -out $1.pk8 -passout stdin
</pre>
<p><code>mkkey.sh</code>  is a helper script to generate the platform's keys.  NOTE: the password you type will be visible in your terminal window.  Note the passwords you use as you will need them to sign release builds.</p>
<p>To generate the required 4 platform keys, run <code>mkkey.sh</code> four times specifying the key name and password for each:</p>
<pre>
sh mkkey.sh platform # enter password
sh mkkey.sh media # enter password
sh mkkey.sh shared # enter password
sh mkkey.sh release # enter password
</pre>
<p>You should now have new keys for your product.</p>
<a name="signing"></a>
<h3>Signing a build for release</h3>
<p>Signing a build for a release is a two-step process.  </p>
<ol>
  <li>Sign all the individual parts of the build.</li>
  <li>Put the parts back together into  image files.</li>
</ol>
<h4>Signing applications</h4>
<p>Use <code>build/tools/releasetools/sign_target_files_apks</code> to sign a <code>target_files</code> package. The <code>target_files</code> package isn't built by default, you need to make sure to specify the "dist" target when you call make.  For example:</p>
<pre>
make -j4 PRODUCT-&lt;product_name&gt;-user dist
</pre>
<p>The command above creates a a file under <code>out/dist </code>called <code>&lt;product_name&gt;-target_files.zip</code>.  This is the file you need to pass to the <code>sign_target_files_apks</code> script.</p>
<p>You would typically run the script like this:</p>
<pre>
./build/tools/releasetools/sign_target_files_apks -d vendor/&lt;vendor_name&gt;/security/&lt;product_name&gt; &lt;product_name&gt;-target_files.zip signed-target-files.zip
</pre>
<p>If you have prebuilt and pre-signed apk's in your build that you don't want re-signed, you must explicitly ignore them by adding <code>-e Foo.apk=</code> to the command line for each apk you wish to ignore.</p>
<p><code>sign_target_files_apks</code> also has many other options that could be useful for signing release builds.  Run it with <code>-h</code> as the only option to see the full help.</p>
<h4>Creating image files</h4>
<p>Once you have <code>signed-target-files.zip</code>, create the images so you can put it onto a device with the command below:</p>
<pre>
build/tools/releasetools/img_from_target_files signed-target-files.zip signed-img.zip
</pre>
<p><code>signed-img.zip</code> contains all the <code>.img</code> files.  You can use <code>fastboot update signed-img.zip</code> to use fastboot to get them on the device.</p>

    </div>

  <a href="#top" style="float:right">&uarr; Go to top</a>
  
  </div>

<div id="footer">


  <div id="copyright">
    

  </div>

  <div id="footerlinks">
    
  <p>
    <a href="http://www.android.com/terms.html">Site Terms of Service</a> -
    <a href="http://www.android.com/privacy.html">Privacy Policy</a>
  </p>
  </div>

</div> <!-- end footer -->

</div><!-- end doc-content -->

</div> <!-- end body-content --> 

<script type="text/javascript">
init(); /* initialize android-developer-docs.js */
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5831155-1");
pageTracker._trackPageview();
</script>

</body>
</html>



